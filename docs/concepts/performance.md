# React æ€§èƒ½ä¼˜åŒ–æ·±åº¦è§£æ

> ğŸš€ æ·±å…¥æ¢ç´¢ React åº”ç”¨æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€æœ¯ã€æœ€ä½³å®è·µå’Œå®æˆ˜ç»éªŒ

## ğŸ“– ç›®å½•

- [æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°](#æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°)
- [React æ¸²æŸ“æœºåˆ¶](#react-æ¸²æŸ“æœºåˆ¶)
- [æ¸²æŸ“ä¼˜åŒ–æŠ€æœ¯](#æ¸²æŸ“ä¼˜åŒ–æŠ€æœ¯)
- [å†…å­˜ç®¡ç†ä¸ä¼˜åŒ–](#å†…å­˜ç®¡ç†ä¸ä¼˜åŒ–)
- [ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½](#ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½)
- [è™šæ‹ŸåŒ–æŠ€æœ¯](#è™šæ‹ŸåŒ–æŠ€æœ¯)
- [æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­](#æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­)
- [é«˜çº§ä¼˜åŒ–ç­–ç•¥](#é«˜çº§ä¼˜åŒ–ç­–ç•¥)
- [æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](#æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ)

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–æ¦‚è¿°

### ä¸ºä»€ä¹ˆæ€§èƒ½ä¼˜åŒ–å¦‚æ­¤é‡è¦ï¼Ÿ

åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯¹é¡µé¢å“åº”é€Ÿåº¦çš„æœŸæœ›è¶Šæ¥è¶Šé«˜ã€‚æ ¹æ®ç ”ç©¶æ•°æ®ï¼š

- **53%** çš„ç”¨æˆ·ä¼šæ”¾å¼ƒåŠ è½½æ—¶é—´è¶…è¿‡ **3 ç§’** çš„é¡µé¢
- é¡µé¢åŠ è½½æ—¶é—´æ¯å¢åŠ  **1 ç§’**ï¼Œè½¬åŒ–ç‡ä¸‹é™ **7%**
- **1 ç§’** çš„å»¶è¿Ÿä¼šå¯¼è‡´é¡µé¢æµè§ˆé‡å‡å°‘ **11%**

React åº”ç”¨çš„æ€§èƒ½é—®é¢˜ä¸»è¦ä½“ç°åœ¨ï¼š

1. **é¦–å±åŠ è½½æ…¢** - å¤§å‹ bundleã€èµ„æºåŠ è½½
2. **äº¤äº’å“åº”æ…¢** - å¤æ‚è®¡ç®—ã€é¢‘ç¹é‡æ¸²æŸ“
3. **å†…å­˜æ³„æ¼** - äº‹ä»¶ç›‘å¬å™¨ã€å®šæ—¶å™¨ã€é—­åŒ…
4. **å¡é¡¿æ‰å¸§** - å¤§é‡ DOM æ“ä½œã€é•¿ä»»åŠ¡é˜»å¡

### æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç›®æ ‡

#### ğŸ¯ Core Web Vitals

Google æå‡ºçš„æ ¸å¿ƒç½‘ç»œæŒ‡æ ‡ï¼Œæ˜¯è¡¡é‡ç”¨æˆ·ä½“éªŒçš„å…³é”®æŒ‡æ ‡ï¼š

- **LCP (Largest Contentful Paint)** - æœ€å¤§å†…å®¹ç»˜åˆ¶æ—¶é—´ < 2.5s
- **FID (First Input Delay)** - é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ < 100ms  
- **CLS (Cumulative Layout Shift)** - ç´¯ç§¯å¸ƒå±€åç§» < 0.1

#### ğŸ“Š React ç‰¹å®šæŒ‡æ ‡

- **ç»„ä»¶æ¸²æŸ“æ—¶é—´** - å•æ¬¡æ¸²æŸ“ < 16ms (60fps)
- **å†…å­˜ä½¿ç”¨** - åˆç†æ§åˆ¶åœ¨ 50MB ä»¥ä¸‹
- **åŒ…ä½“ç§¯** - ä¸»åŒ… < 500KBï¼Œæ€»ä½“ç§¯ < 2MB
- **é‡æ¸²æŸ“é¢‘ç‡** - é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

## âš™ï¸ React æ¸²æŸ“æœºåˆ¶

### React æ¸²æŸ“æµç¨‹æ·±åº¦è§£æ

React çš„æ¸²æŸ“è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼š

#### 1. Reconciliation (åè°ƒé˜¶æ®µ)

```
è§¦å‘æ›´æ–° â†’ åˆ›å»º Fiber æ ‘ â†’ Diff ç®—æ³• â†’ æ ‡è®°å‰¯ä½œç”¨
```

**Fiber æ¶æ„çš„ä¼˜åŠ¿**ï¼š
- **å¯ä¸­æ–­æ¸²æŸ“** - é«˜ä¼˜å…ˆçº§ä»»åŠ¡å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡
- **æ—¶é—´åˆ‡ç‰‡** - å°†é•¿ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°ä»»åŠ¡
- **ä¼˜å…ˆçº§è°ƒåº¦** - ä¸åŒç±»å‹çš„æ›´æ–°æœ‰ä¸åŒä¼˜å…ˆçº§

#### 2. Commit (æäº¤é˜¶æ®µ)

```
Dom æ›´æ–° â†’ ç”Ÿå‘½å‘¨æœŸè°ƒç”¨ â†’ ref æ›´æ–° â†’ å‰¯ä½œç”¨æ¸…ç†
```

### è§¦å‘é‡æ¸²æŸ“çš„æ¡ä»¶

React ç»„ä»¶é‡æ–°æ¸²æŸ“çš„è§¦å‘æ¡ä»¶ï¼š

1. **State å˜åŒ–** - useStateã€useReducer
2. **Props å˜åŒ–** - çˆ¶ç»„ä»¶ä¼ é€’çš„ props å‘ç”Ÿå˜åŒ–
3. **Context å˜åŒ–** - useContext ç›‘å¬çš„ Context å€¼å˜åŒ–
4. **å¼ºåˆ¶æ›´æ–°** - forceUpdate (ç±»ç»„ä»¶) æˆ– key å˜åŒ–

### æ¸²æŸ“æ€§èƒ½çš„å…³é”®å› ç´ 

#### ğŸ”„ ç»„ä»¶æ›´æ–°é¢‘ç‡

```jsx
// âŒ é—®é¢˜ï¼šçˆ¶ç»„ä»¶é¢‘ç¹æ›´æ–°å¯¼è‡´å­ç»„ä»¶æ— æ„ä¹‰é‡æ¸²æŸ“
function Parent() {
  const [count, setCount] = useState(0);
  const [input, setInput] = useState('');
  
  return (
    <>
      <input value={input} onChange={e => setInput(e.target.value)} />
      <ExpensiveChild data={someStaticData} />
    </>
  );
}

// âœ… è§£å†³ï¼šä½¿ç”¨ React.memo åŒ…è£…å­ç»„ä»¶
const ExpensiveChild = React.memo(({ data }) => {
  return <div>{/* æ˜‚è´µçš„æ¸²æŸ“é€»è¾‘ */}</div>;
});
```

#### ğŸ§® è®¡ç®—å¤æ‚åº¦

```jsx
// âŒ é—®é¢˜ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½è¿›è¡Œå¤æ‚è®¡ç®—
function Component({ items }) {
  const expensiveValue = items.filter(...).map(...).reduce(...);
  return <div>{expensiveValue}</div>;
}

// âœ… è§£å†³ï¼šä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
function Component({ items }) {
  const expensiveValue = useMemo(() => {
    return items.filter(...).map(...).reduce(...);
  }, [items]);
  
  return <div>{expensiveValue}</div>;
}
```

## ğŸ¨ æ¸²æŸ“ä¼˜åŒ–æŠ€æœ¯

### 1. React.memo - ç»„ä»¶è®°å¿†åŒ–

React.memo æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç”¨äºé˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼š

```jsx
// åŸºç¡€ç”¨æ³•
const MyComponent = React.memo(function MyComponent({ name, age }) {
  return <div>{name} is {age} years old</div>;
});

// è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°
const MyComponent = React.memo(function MyComponent(props) {
  return <div>{props.user.name}</div>;
}, (prevProps, nextProps) => {
  // è¿”å› true è¡¨ç¤º props ç›¸ç­‰ï¼Œä¸éœ€è¦é‡æ¸²æŸ“
  return prevProps.user.id === nextProps.user.id;
});
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- çº¯å±•ç¤ºç»„ä»¶
- props å˜åŒ–é¢‘ç‡ä½çš„ç»„ä»¶
- æ¸²æŸ“æˆæœ¬è¾ƒé«˜çš„ç»„ä»¶

**æ³¨æ„äº‹é¡¹**ï¼š
- å¯¹è±¡å’Œå‡½æ•° props å¯èƒ½å¯¼è‡´è®°å¿†åŒ–å¤±æ•ˆ
- è¿‡åº¦ä½¿ç”¨å¯èƒ½å½±å“æ€§èƒ½ï¼ˆæ¯”è¾ƒæˆæœ¬ï¼‰

### 2. useMemo - å€¼è®°å¿†åŒ–

ç¼“å­˜æ˜‚è´µè®¡ç®—çš„ç»“æœï¼š

```jsx
function ExpensiveComponent({ items, filter }) {
  // ç¼“å­˜è¿‡æ»¤å’Œæ’åºçš„ç»“æœ
  const filteredItems = useMemo(() => {
    console.log('Computing filtered items...');
    return items
      .filter(item => item.category === filter)
      .sort((a, b) => b.score - a.score);
  }, [items, filter]);

  // ç¼“å­˜å¤æ‚çš„è®¡ç®—
  const statistics = useMemo(() => {
    console.log('Computing statistics...');
    return {
      total: filteredItems.length,
      average: filteredItems.reduce((sum, item) => sum + item.score, 0) / filteredItems.length,
      max: Math.max(...filteredItems.map(item => item.score))
    };
  }, [filteredItems]);

  return (
    <div>
      <h3>Statistics</h3>
      <p>Total: {statistics.total}</p>
      <p>Average: {statistics.average.toFixed(2)}</p>
      <p>Max Score: {statistics.max}</p>
      
      <h3>Items</h3>
      {filteredItems.map(item => (
        <div key={item.id}>{item.name}: {item.score}</div>
      ))}
    </div>
  );
}
```

### 3. useCallback - å‡½æ•°è®°å¿†åŒ–

ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼š

```jsx
function TodoApp() {
  const [todos, setTodos] = useState([]);
  const [filter, setFilter] = useState('all');

  // ç¼“å­˜æ·»åŠ å‡½æ•°
  const addTodo = useCallback((text) => {
    setTodos(prev => [...prev, {
      id: Date.now(),
      text,
      completed: false
    }]);
  }, []);

  // ç¼“å­˜åˆ‡æ¢å‡½æ•°
  const toggleTodo = useCallback((id) => {
    setTodos(prev => prev.map(todo =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  }, []);

  // ç¼“å­˜è¿‡æ»¤åçš„æ•°æ®
  const filteredTodos = useMemo(() => {
    switch (filter) {
      case 'active': return todos.filter(todo => !todo.completed);
      case 'completed': return todos.filter(todo => todo.completed);
      default: return todos;
    }
  }, [todos, filter]);

  return (
    <div>
      <TodoInput onAdd={addTodo} />
      <TodoList todos={filteredTodos} onToggle={toggleTodo} />
      <TodoFilter filter={filter} onFilterChange={setFilter} />
    </div>
  );
}

// å­ç»„ä»¶ä½¿ç”¨ memo ä¼˜åŒ–
const TodoInput = React.memo(({ onAdd }) => {
  const [text, setText] = useState('');
  
  const handleSubmit = (e) => {
    e.preventDefault();
    if (text.trim()) {
      onAdd(text.trim());
      setText('');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input value={text} onChange={e => setText(e.target.value)} />
      <button type="submit">Add Todo</button>
    </form>
  );
});
```

### 4. åˆ—è¡¨æ¸²æŸ“ä¼˜åŒ–

#### ä½¿ç”¨æ­£ç¡®çš„ key

```jsx
// âŒ ä½¿ç”¨æ•°ç»„ç´¢å¼•ä½œä¸º keyï¼ˆå¯èƒ½å¯¼è‡´æ¸²æŸ“é—®é¢˜ï¼‰
{items.map((item, index) => (
  <TodoItem key={index} todo={item} />
))}

// âœ… ä½¿ç”¨ç¨³å®šçš„å”¯ä¸€æ ‡è¯†ç¬¦
{items.map(item => (
  <TodoItem key={item.id} todo={item} />
))}

// âœ… å¯¹äºçœŸæ­£é™æ€çš„åˆ—è¡¨ï¼Œç´¢å¼•æ˜¯å¯ä»¥çš„
{staticItems.map((item, index) => (
  <StaticItem key={index} item={item} />
))}
```

#### é¿å…åœ¨æ¸²æŸ“ä¸­åˆ›å»ºæ–°å¯¹è±¡

```jsx
// âŒ æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¯¹è±¡
function UserList({ users }) {
  return (
    <div>
      {users.map(user => (
        <UserCard 
          key={user.id} 
          user={user}
          style={{ margin: '10px' }} // æ¯æ¬¡éƒ½æ˜¯æ–°å¯¹è±¡
          onClick={() => console.log(user.id)} // æ¯æ¬¡éƒ½æ˜¯æ–°å‡½æ•°
        />
      ))}
    </div>
  );
}

// âœ… å°†é™æ€å€¼æå–åˆ°ç»„ä»¶å¤–éƒ¨
const cardStyle = { margin: '10px' };

function UserList({ users }) {
  const handleClick = useCallback((userId) => {
    console.log(userId);
  }, []);

  return (
    <div>
      {users.map(user => (
        <UserCard 
          key={user.id} 
          user={user}
          style={cardStyle}
          onClick={handleClick}
        />
      ))}
    </div>
  );
}
```

## ğŸ§  å†…å­˜ç®¡ç†ä¸ä¼˜åŒ–

### å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› 

#### 1. äº‹ä»¶ç›‘å¬å™¨æœªæ¸…ç†

```jsx
// âŒ é—®é¢˜ï¼šäº‹ä»¶ç›‘å¬å™¨æœªæ¸…ç†
function Component() {
  useEffect(() => {
    const handleScroll = () => {
      console.log('scrolling...');
    };
    
    window.addEventListener('scroll', handleScroll);
    // å¿˜è®°æ¸…ç†ç›‘å¬å™¨
  }, []);

  return <div>Content</div>;
}

// âœ… è§£å†³ï¼šæ­£ç¡®æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
function Component() {
  useEffect(() => {
    const handleScroll = () => {
      console.log('scrolling...');
    };
    
    window.addEventListener('scroll', handleScroll);
    
    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
  }, []);

  return <div>Content</div>;
}
```

#### 2. å®šæ—¶å™¨æœªæ¸…ç†

```jsx
// âŒ é—®é¢˜ï¼šå®šæ—¶å™¨æœªæ¸…ç†
function Timer() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
    // å¿˜è®°æ¸…ç†å®šæ—¶å™¨
  }, []);

  return <div>Count: {count}</div>;
}

// âœ… è§£å†³ï¼šæ¸…ç†å®šæ—¶å™¨
function Timer() {
  const [count, setCount] = useState(0);
  
  useEffect(() => {
    const timer = setInterval(() => {
      setCount(prev => prev + 1);
    }, 1000);
    
    return () => {
      clearInterval(timer);
    };
  }, []);

  return <div>Count: {count}</div>;
}
```

#### 3. å¼‚æ­¥æ“ä½œæœªå–æ¶ˆ

```jsx
// âŒ é—®é¢˜ï¼šç»„ä»¶å¸è½½åå¼‚æ­¥æ“ä½œä»åœ¨æ‰§è¡Œ
function DataComponent() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    setLoading(true);
    fetch('/api/data')
      .then(response => response.json())
      .then(data => {
        setData(data); // ç»„ä»¶å¯èƒ½å·²ç»å¸è½½
        setLoading(false);
      });
  }, []);

  return loading ? <div>Loading...</div> : <div>{data}</div>;
}

// âœ… è§£å†³ï¼šä½¿ç”¨ AbortController æˆ–æ ‡å¿—ä½
function DataComponent() {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    const controller = new AbortController();
    
    setLoading(true);
    fetch('/api/data', { signal: controller.signal })
      .then(response => response.json())
      .then(data => {
        setData(data);
        setLoading(false);
      })
      .catch(error => {
        if (error.name !== 'AbortError') {
          console.error('Fetch error:', error);
        }
      });
    
    return () => {
      controller.abort();
    };
  }, []);

  return loading ? <div>Loading...</div> : <div>{data}</div>;
}
```

### å†…å­˜ä¼˜åŒ–ç­–ç•¥

#### 1. å¯¹è±¡æ± æ¨¡å¼

```jsx
// å¯¹è±¡æ± å‡å°‘åƒåœ¾å›æ”¶å‹åŠ›
class ObjectPool {
  constructor(createFn, resetFn) {
    this.createFn = createFn;
    this.resetFn = resetFn;
    this.pool = [];
  }
  
  get() {
    if (this.pool.length > 0) {
      return this.pool.pop();
    }
    return this.createFn();
  }
  
  release(obj) {
    this.resetFn(obj);
    this.pool.push(obj);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const pointPool = new ObjectPool(
  () => ({ x: 0, y: 0 }),
  (point) => { point.x = 0; point.y = 0; }
);
```

#### 2. WeakMap é¿å…å¾ªç¯å¼•ç”¨

```jsx
// ä½¿ç”¨ WeakMap å­˜å‚¨ç§æœ‰æ•°æ®
const privateData = new WeakMap();

class Component {
  constructor(props) {
    privateData.set(this, {
      internalState: {},
      cache: new Map()
    });
  }
  
  getPrivateData() {
    return privateData.get(this);
  }
}
```

## ğŸ“¦ ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½

### è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²

```jsx
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// æ‡’åŠ è½½é¡µé¢ç»„ä»¶
const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));
const Contact = lazy(() => import('./pages/Contact'));

// é¢„åŠ è½½ç­–ç•¥
const Dashboard = lazy(() => 
  import(/* webpackPreload: true */ './pages/Dashboard')
);

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<div>Loading...</div>}>
        <Routes>
          <Route path="/" element={<Home />} />
          <Route path="/about" element={<About />} />
          <Route path="/contact" element={<Contact />} />
          <Route path="/dashboard" element={<Dashboard />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

### ç»„ä»¶çº§åˆ«çš„æ‡’åŠ è½½

```jsx
import { useState, lazy, Suspense } from 'react';

// æŒ‰éœ€åŠ è½½é‡å‹ç»„ä»¶
const HeavyChart = lazy(() => import('./HeavyChart'));
const DataTable = lazy(() => import('./DataTable'));

function Dashboard() {
  const [activeTab, setActiveTab] = useState('overview');
  
  return (
    <div>
      <nav>
        <button onClick={() => setActiveTab('overview')}>Overview</button>
        <button onClick={() => setActiveTab('chart')}>Chart</button>
        <button onClick={() => setActiveTab('data')}>Data</button>
      </nav>
      
      <Suspense fallback={<div>Loading component...</div>}>
        {activeTab === 'overview' && <Overview />}
        {activeTab === 'chart' && <HeavyChart />}
        {activeTab === 'data' && <DataTable />}
      </Suspense>
    </div>
  );
}
```

### æ™ºèƒ½é¢„åŠ è½½

```jsx
// é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½
function NavigationLink({ to, children }) {
  const [isHovered, setIsHovered] = useState(false);
  
  useEffect(() => {
    if (isHovered) {
      // é¢„åŠ è½½è·¯ç”±ç»„ä»¶
      import(`./pages/${to}`);
    }
  }, [isHovered, to]);
  
  return (
    <Link
      to={to}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      {children}
    </Link>
  );
}

// åŸºäºäº¤å‰è§‚å¯Ÿå™¨çš„é¢„åŠ è½½
function useLazyLoad(threshold = 0.1) {
  const [isVisible, setIsVisible] = useState(false);
  const ref = useRef();
  
  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.disconnect();
        }
      },
      { threshold }
    );
    
    if (ref.current) {
      observer.observe(ref.current);
    }
    
    return () => observer.disconnect();
  }, [threshold]);
  
  return [ref, isVisible];
}
```

## ğŸ¯ è™šæ‹ŸåŒ–æŠ€æœ¯

### å›ºå®šé«˜åº¦è™šæ‹Ÿåˆ—è¡¨

```jsx
function VirtualList({ 
  items, 
  itemHeight, 
  containerHeight, 
  renderItem 
}) {
  const [scrollTop, setScrollTop] = useState(0);
  
  // è®¡ç®—å¯è§èŒƒå›´
  const startIndex = Math.floor(scrollTop / itemHeight);
  const endIndex = Math.min(
    items.length - 1,
    Math.floor((scrollTop + containerHeight) / itemHeight)
  );
  
  // å¯è§é¡¹ç›®
  const visibleItems = [];
  for (let i = startIndex; i <= endIndex; i++) {
    visibleItems.push({
      index: i,
      item: items[i],
      offsetY: i * itemHeight
    });
  }
  
  const totalHeight = items.length * itemHeight;
  
  return (
    <div 
      style={{ 
        height: containerHeight, 
        overflow: 'auto' 
      }}
      onScroll={(e) => setScrollTop(e.target.scrollTop)}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        {visibleItems.map(({ index, item, offsetY }) => (
          <div
            key={index}
            style={{
              position: 'absolute',
              top: offsetY,
              left: 0,
              right: 0,
              height: itemHeight
            }}
          >
            {renderItem(item, index)}
          </div>
        ))}
      </div>
    </div>
  );
}
```

### åŠ¨æ€é«˜åº¦è™šæ‹Ÿåˆ—è¡¨

```jsx
function DynamicVirtualList({ 
  items, 
  estimatedItemHeight, 
  containerHeight, 
  renderItem 
}) {
  const [itemHeights, setItemHeights] = useState(new Map());
  const [scrollTop, setScrollTop] = useState(0);
  
  // è®¡ç®—æ¯ä¸ªé¡¹ç›®çš„ä½ç½®
  const getItemOffset = (index) => {
    let offset = 0;
    for (let i = 0; i < index; i++) {
      offset += itemHeights.get(i) || estimatedItemHeight;
    }
    return offset;
  };
  
  // æ‰¾åˆ°å¯è§é¡¹ç›®
  const getVisibleItems = () => {
    const visibleItems = [];
    let accumulatedHeight = 0;
    
    for (let i = 0; i < items.length; i++) {
      const itemHeight = itemHeights.get(i) || estimatedItemHeight;
      const itemTop = accumulatedHeight;
      const itemBottom = accumulatedHeight + itemHeight;
      
      if (itemBottom >= scrollTop && itemTop <= scrollTop + containerHeight) {
        visibleItems.push({
          index: i,
          item: items[i],
          offsetY: itemTop
        });
      }
      
      if (itemTop > scrollTop + containerHeight) {
        break;
      }
      
      accumulatedHeight += itemHeight;
    }
    
    return visibleItems;
  };
  
  const visibleItems = getVisibleItems();
  const totalHeight = getItemOffset(items.length);
  
  // æµ‹é‡é¡¹ç›®é«˜åº¦
  const measureItem = useCallback((index, height) => {
    setItemHeights(prev => {
      if (prev.get(index) !== height) {
        const newMap = new Map(prev);
        newMap.set(index, height);
        return newMap;
      }
      return prev;
    });
  }, []);
  
  return (
    <div 
      style={{ 
        height: containerHeight, 
        overflow: 'auto' 
      }}
      onScroll={(e) => setScrollTop(e.target.scrollTop)}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        {visibleItems.map(({ index, item, offsetY }) => (
          <MeasuredItem
            key={index}
            index={index}
            offsetY={offsetY}
            onMeasure={measureItem}
          >
            {renderItem(item, index)}
          </MeasuredItem>
        ))}
      </div>
    </div>
  );
}

// æµ‹é‡ç»„ä»¶
function MeasuredItem({ index, offsetY, onMeasure, children }) {
  const ref = useRef();
  
  useEffect(() => {
    if (ref.current) {
      const resizeObserver = new ResizeObserver(([entry]) => {
        onMeasure(index, entry.contentRect.height);
      });
      
      resizeObserver.observe(ref.current);
      
      return () => resizeObserver.disconnect();
    }
  }, [index, onMeasure]);
  
  return (
    <div
      ref={ref}
      style={{
        position: 'absolute',
        top: offsetY,
        left: 0,
        right: 0
      }}
    >
      {children}
    </div>
  );
}
```

## ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è¯Šæ–­

### Web Vitals ç›‘æ§

```jsx
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function setupPerformanceMonitoring() {
  // ç›‘æ§æ ¸å¿ƒæŒ‡æ ‡
  getCLS(console.log);
  getFID(console.log);
  getFCP(console.log);
  getLCP(console.log);
  getTTFB(console.log);
}

// è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§ Hook
function usePerformanceMetrics() {
  const [metrics, setMetrics] = useState({});
  
  useEffect(() => {
    const handleMetric = (metric) => {
      setMetrics(prev => ({
        ...prev,
        [metric.name]: metric.value
      }));
    };
    
    getCLS(handleMetric);
    getFID(handleMetric);
    getFCP(handleMetric);
    getLCP(handleMetric);
    getTTFB(handleMetric);
  }, []);
  
  return metrics;
}
```

### React æ€§èƒ½åˆ†æ

```jsx
// React Profiler API
import { Profiler } from 'react';

function onRenderCallback(id, phase, actualDuration, baseDuration, startTime, commitTime, interactions) {
  console.log('Component:', id);
  console.log('Phase:', phase); // "mount" or "update"
  console.log('Actual duration:', actualDuration);
  console.log('Base duration:', baseDuration);
  
  // å‘é€åˆ°åˆ†ææœåŠ¡
  if (actualDuration > 16) { // è¶…è¿‡ 16ms
    analytics.track('slow-render', {
      componentId: id,
      duration: actualDuration,
      phase
    });
  }
}

function App() {
  return (
    <Profiler id="App" onRender={onRenderCallback}>
      <Router>
        <Routes>
          <Route path="/" element={<Home />} />
        </Routes>
      </Router>
    </Profiler>
  );
}
```

### è‡ªå®šä¹‰æ€§èƒ½ç›‘æ§

```jsx
// æ¸²æŸ“æ—¶é—´ç›‘æ§
function useRenderTime(componentName) {
  const renderCount = useRef(0);
  const renderTimes = useRef([]);
  
  useEffect(() => {
    renderCount.current += 1;
    const startTime = performance.now();
    
    return () => {
      const endTime = performance.now();
      const renderTime = endTime - startTime;
      renderTimes.current.push(renderTime);
      
      // ä¿æŒæœ€è¿‘ 10 æ¬¡è®°å½•
      if (renderTimes.current.length > 10) {
        renderTimes.current = renderTimes.current.slice(-10);
      }
      
      console.log(`${componentName} render #${renderCount.current}: ${renderTime.toFixed(2)}ms`);
    };
  });
  
  const getAverageRenderTime = () => {
    if (renderTimes.current.length === 0) return 0;
    const sum = renderTimes.current.reduce((a, b) => a + b, 0);
    return sum / renderTimes.current.length;
  };
  
  return {
    renderCount: renderCount.current,
    getAverageRenderTime
  };
}
```

## ğŸ¯ é«˜çº§ä¼˜åŒ–ç­–ç•¥

### 1. çŠ¶æ€ç»“æ„ä¼˜åŒ–

```jsx
// âŒ æ‰å¹³çŠ¶æ€å¯¼è‡´è¿‡å¤šé‡æ¸²æŸ“
function App() {
  const [userName, setUserName] = useState('');
  const [userEmail, setUserEmail] = useState('');
  const [userAge, setUserAge] = useState(0);
  const [posts, setPosts] = useState([]);
  const [comments, setComments] = useState([]);
  
  // ä»»ä½•ä¸€ä¸ªå­—æ®µå˜åŒ–éƒ½ä¼šé‡æ¸²æŸ“æ•´ä¸ªç»„ä»¶
}

// âœ… åˆ†ç»„ç›¸å…³çŠ¶æ€
function App() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    age: 0
  });
  const [posts, setPosts] = useState([]);
  const [comments, setComments] = useState([]);
  
  // æˆ–è€…ä½¿ç”¨å¤šä¸ª context è¿›ä¸€æ­¥åˆ†ç¦»
}
```

### 2. Context ä¼˜åŒ–

```jsx
// âŒ å•ä¸€å¤§ Context å¯¼è‡´è¿‡å¤šé‡æ¸²æŸ“
const AppContext = createContext();

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [theme, setTheme] = useState('light');
  const [posts, setPosts] = useState([]);
  
  const value = {
    user, setUser,
    theme, setTheme,
    posts, setPosts
  };
  
  return (
    <AppContext.Provider value={value}>
      {children}
    </AppContext.Provider>
  );
}

// âœ… åˆ†ç¦»ä¸åŒå…³æ³¨ç‚¹çš„ Context
const UserContext = createContext();
const ThemeContext = createContext();
const PostsContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  const value = useMemo(() => ({ user, setUser }), [user]);
  
  return (
    <UserContext.Provider value={value}>
      {children}
    </UserContext.Provider>
  );
}

// è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåˆ†ç¦»è¯»å†™
const UserStateContext = createContext();
const UserActionsContext = createContext();

function UserProvider({ children }) {
  const [user, setUser] = useState(null);
  
  const actions = useMemo(() => ({
    updateUser: setUser,
    clearUser: () => setUser(null)
  }), []);
  
  return (
    <UserStateContext.Provider value={user}>
      <UserActionsContext.Provider value={actions}>
        {children}
      </UserActionsContext.Provider>
    </UserStateContext.Provider>
  );
}
```

### 3. æ‰¹é‡æ›´æ–°ä¼˜åŒ–

```jsx
// React 18 è‡ªåŠ¨æ‰¹é‡æ›´æ–°
function handleClick() {
  setCount(prev => prev + 1);
  setFlag(prev => !prev);
  // React 18 ä¼šè‡ªåŠ¨æ‰¹é‡è¿™äº›æ›´æ–°
}

// æ‰‹åŠ¨æ§åˆ¶æ‰¹é‡æ›´æ–°
import { unstable_batchedUpdates } from 'react-dom';

function handleAsyncUpdate() {
  setTimeout(() => {
    unstable_batchedUpdates(() => {
      setCount(prev => prev + 1);
      setFlag(prev => !prev);
    });
  }, 1000);
}

// ä½¿ç”¨ useTransition æ ‡è®°éç´§æ€¥æ›´æ–°
function SearchResults() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [isPending, startTransition] = useTransition();
  
  const handleSearch = (newQuery) => {
    setQuery(newQuery); // ç´§æ€¥æ›´æ–°ï¼Œç«‹å³å“åº”ç”¨æˆ·è¾“å…¥
    
    startTransition(() => {
      // éç´§æ€¥æ›´æ–°ï¼Œå¯ä»¥è¢«ä¸­æ–­
      setResults(performExpensiveSearch(newQuery));
    });
  };
  
  return (
    <div>
      <input onChange={e => handleSearch(e.target.value)} />
      {isPending ? <div>Searching...</div> : <Results data={results} />}
    </div>
  );
}
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

### å¼€å‘é˜¶æ®µæœ€ä½³å®è·µ

1. **ä½¿ç”¨ React DevTools Profiler**
   - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
   - åˆ†æç»„ä»¶æ¸²æŸ“é¢‘ç‡
   - æŸ¥çœ‹ commit é˜¶æ®µè€—æ—¶

2. **è®¾ç½®æ€§èƒ½é¢„ç®—**
   ```javascript
   // webpack.config.js
   module.exports = {
     performance: {
       maxAssetSize: 250000, // 250KB
       maxEntrypointSize: 250000,
       hints: 'error'
     }
   };
   ```

3. **ä½¿ç”¨ ESLint è§„åˆ™**
   ```json
   {
     "rules": {
       "react-hooks/exhaustive-deps": "error",
       "react/jsx-no-bind": "error",
       "react/jsx-no-literals": "warn"
     }
   }
   ```

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **Tree Shaking**
   ```javascript
   // åªå¯¼å…¥éœ€è¦çš„éƒ¨åˆ†
   import { debounce } from 'lodash/debounce'; // âœ…
   import _ from 'lodash'; // âŒ
   
   // ä½¿ç”¨ ES6 æ¨¡å—
   export const utility1 = () => {};
   export const utility2 = () => {};
   ```

2. **èµ„æºä¼˜åŒ–**
   ```javascript
   // å›¾ç‰‡æ‡’åŠ è½½
   function LazyImage({ src, alt }) {
     const [imageSrc, setImageSrc] = useState(null);
     const [imageRef, isIntersecting] = useIntersectionObserver({
       threshold: 0.1
     });
     
     useEffect(() => {
       if (isIntersecting) {
         setImageSrc(src);
       }
     }, [isIntersecting, src]);
     
     return (
       <img
         ref={imageRef}
         src={imageSrc}
         alt={alt}
         loading="lazy"
       />
     );
   }
   ```

3. **Service Worker ç¼“å­˜**
   ```javascript
   // ç¼“å­˜ç­–ç•¥
   const CACHE_NAME = 'react-app-v1';
   const urlsToCache = [
     '/',
     '/static/js/bundle.js',
     '/static/css/main.css'
   ];
   
   self.addEventListener('install', event => {
     event.waitUntil(
       caches.open(CACHE_NAME)
         .then(cache => cache.addAll(urlsToCache))
     );
   });
   ```

### æ€§èƒ½ç›‘æ§å’ŒæŒç»­ä¼˜åŒ–

1. **å»ºç«‹æ€§èƒ½æŒ‡æ ‡åŸºçº¿**
   ```javascript
   const performanceThresholds = {
     FCP: 1800, // ms
     LCP: 2500, // ms
     FID: 100,  // ms
     CLS: 0.1,  // score
     renderTime: 16, // ms
     bundleSize: 500 // KB
   };
   ```

2. **è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•**
   ```javascript
   // ä½¿ç”¨ Lighthouse CI
   module.exports = {
     ci: {
       collect: {
         numberOfRuns: 3,
         settings: {
           chromeFlags: '--no-sandbox'
         }
       },
       assert: {
         assertions: {
           'categories:performance': ['error', { minScore: 0.9 }],
           'categories:accessibility': ['error', { minScore: 0.9 }]
         }
       }
     }
   };
   ```

### æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

#### ğŸ¯ æ¸²æŸ“ä¼˜åŒ–
- [ ] ä½¿ç”¨ React.memo åŒ…è£…çº¯ç»„ä»¶
- [ ] ä½¿ç”¨ useMemo ç¼“å­˜æ˜‚è´µè®¡ç®—
- [ ] ä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°å¼•ç”¨
- [ ] é¿å…åœ¨æ¸²æŸ“ä¸­åˆ›å»ºå¯¹è±¡å’Œå‡½æ•°
- [ ] æ­£ç¡®ä½¿ç”¨ key å±æ€§

#### ğŸ§  å†…å­˜ä¼˜åŒ–
- [ ] æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
- [ ] æ¸…ç†å®šæ—¶å™¨å’Œé—´éš”å™¨
- [ ] å–æ¶ˆæœªå®Œæˆçš„å¼‚æ­¥æ“ä½œ
- [ ] é¿å…é—­åŒ…å†…å­˜æ³„æ¼
- [ ] ä½¿ç”¨ WeakMap å’Œ WeakSet

#### ğŸ“¦ ä»£ç åˆ†å‰²
- [ ] è·¯ç”±çº§åˆ«ä»£ç åˆ†å‰²
- [ ] ç»„ä»¶çº§åˆ«æ‡’åŠ è½½
- [ ] ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¯¼å…¥
- [ ] æ™ºèƒ½é¢„åŠ è½½ç­–ç•¥

#### ğŸ¯ è™šæ‹ŸåŒ–
- [ ] å¤§åˆ—è¡¨ä½¿ç”¨è™šæ‹ŸåŒ–
- [ ] æ— é™æ»šåŠ¨ä¼˜åŒ–
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] å†…å®¹å¯è§æ€§ä¼˜åŒ–

#### ğŸ“Š ç›‘æ§è¯Šæ–­
- [ ] Web Vitals ç›‘æ§
- [ ] React æ€§èƒ½åˆ†æ
- [ ] è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡
- [ ] é”™è¯¯è¾¹ç•Œå¤„ç†

## ğŸ”— ç›¸å…³èµ„æº

### ğŸ® å®æˆ˜æ¼”ç¤º
- **[æ€§èƒ½ä¼˜åŒ–å®è·µæ¼”ç¤º â†’](http://localhost:3008)** - å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯å®æˆ˜
- **[æ¸²æŸ“ä¼˜åŒ–æ¼”ç¤º â†’](http://localhost:3008/render-optimization)** - React.memo, useMemo, useCallback å®æˆ˜
- **[å†…å­˜ç®¡ç†æ¼”ç¤º â†’](http://localhost:3008/memory-management)** - å†…å­˜æ³„æ¼æ£€æµ‹ä¸ä¼˜åŒ–
- **[ä»£ç åˆ†å‰²æ¼”ç¤º â†’](http://localhost:3008/code-splitting)** - æ‡’åŠ è½½å’Œé¢„åŠ è½½ç­–ç•¥
- **[è™šæ‹ŸåŒ–æ¼”ç¤º â†’](http://localhost:3008/virtualization)** - å¤§åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–
- **[æ€§èƒ½ç›‘æ§æ¼”ç¤º â†’](http://localhost:3008/performance-monitoring)** - å®æ—¶æ€§èƒ½æŒ‡æ ‡ç›‘æ§
- **[ä¼˜åŒ–å¯¹æ¯”åˆ†æ â†’](http://localhost:3008/comparison)** - ä¼˜åŒ–å‰åæ•ˆæœå¯¹æ¯”

### ğŸ“š ç†è®ºå»¶ä¼¸
- [React Hooks æ·±åº¦è§£æ â†’](/docs/concepts/hooks)
- [çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ â†’](/docs/concepts/state-management)
- [React ç‰ˆæœ¬æ¼”è¿› â†’](/docs/versions/)
- [ç»„ä»¶è®¾è®¡æ¨¡å¼ â†’](/docs/patterns/component-patterns)

### ğŸ› ï¸ å·¥å…·æ¨è
- **React DevTools Profiler** - ç»„ä»¶æ€§èƒ½åˆ†æ
- **Lighthouse** - ç½‘é¡µæ€§èƒ½å®¡è®¡
- **Web Vitals Extension** - å®æ—¶æ€§èƒ½ç›‘æ§
- **Bundle Analyzer** - åŒ…ä½“ç§¯åˆ†æ
- **React Window** - è™šæ‹ŸåŒ–ç»„ä»¶åº“

---

*æŒç»­å­¦ä¹ ï¼ŒæŒç»­ä¼˜åŒ– - React æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜* ğŸš€
